{% load static %}

<html lang="en">
<head>

    <!-- Font awesome -->
    <script type="text/javascript"> (function () {
        var css = document.createElement('link');
        css.href = '//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css';
        css.rel = 'stylesheet';
        css.type = 'text/css';
        document.getElementsByTagName('head')[0].appendChild(css);
    })(); </script> <!-- end of Font awesome script -->

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Easy Psycho Study - Editar questionário</title>

    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/ie10-viewport-bug-workaround.css' %}">
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
    <link rel="stylesheet" href="{% static 'css/new_form.css' %}">
    <link rel="stylesheet" href="{% static 'css/toastr.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
    <link rel="stylesheet" href="{% static 'css/clone_form.css' %}">

</head>

<div class="se-pre-con"> <!-- loading spinner -->
    <p align="center">
        <br/>
        <i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i>
        <span class="sr-only">Loading...</span>
    </p>
</div> <!-- ./se-pre-con -->

<!-- Fixed navbar -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand navbar-title-white">Editar Questionário</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse navbar-right">

            <button type="button" class="btn btn-default navbar-btn btn-wide"
                    onclick="visualization()" data-toggle="modal"
                    data-target="#modal-for-full-screen">
                <span class="glyphicon glyphicon-eye-open"></span> Pré-Visualizar
            </button>

            <button type="button" class="btn btn-info navbar-btn btn-wide"><span
                    class="glyphicon glyphicon-question-sign"></span> Ajuda
            </button>

            <button type="button" class="btn btn-success navbar-btn btn-wide"
                    onclick="submitEditedForm()">
                <span class="glyphicon glyphicon-floppy-saved"></span> Guardar
            </button>

            <button type="button" class="btn btn-danger navbar-btn btn-wide"
                    data-toggle="modal"
                    data-target="#modal-for-cancel">
                <span class="glyphicon glyphicon-floppy-remove"></span> Cancelar
            </button>

        </div><!-- /.nav-collapse -->
    </div>
</nav>

<body>

<!-- Modal  for canceling form creation -->
<div class="modal fade" id="modal-for-cancel" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <p style="font-size: large; font-weight: bold;" align="center" class="modal-title">Cancelar Edição</p>
            </div>
            <div class="modal-body">
                <p align="center">Tem certeza que deseja cancelar a edição deste questionário?</p>
                <p align="center">
                    <button type="button" class="btn btn-success" value="click" id="cancel-form">
                        <span class="glyphicon glyphicon-ok"></span> Sim
                    </button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal"><span
                            class="glyphicon glyphicon-remove"></span> Não
                    </button>
                </p>
            </div>
        </div>

    </div>
</div>

<br/>

<div class="container" id="clone-container" style="display: none">
    <div class="row">

        <div class="col-sm-3">
            <div class="alert alert-success alert-dismissable">
                <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                <span class="glyphicon glyphicon-ok-sign"></span> O seu questionário <strong>deve conter sempre</strong>:
                <ul>
                    <li>Nome;</li>
                    <li>Descrição;</li>
                    <li>Estilo (branco/preto);</li>
                    <li>Uma ou mais tarefas com elementos.</li>
                </ul>
            </div>

            <div class="alert alert-info alert-dismissable">
                <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                <span class="glyphicon glyphicon-info-sign"></span> Clique sempre no botão <strong><span
                    class="glyphicon glyphicon-import"></span> Carregar</strong> quando fizer importação de imagens após
                a pesquisa, caso contrário estas não aparecerão no seu questionário.
            </div>
        </div> <!-- ./ col-sm-3 -->

        <div class="col-sm-6">
            <form id="form-questionnaire">

                <div class="form-group"> <!-- form name -->
                    <label for="form-name">Nome do questionário</label> <span class="mandatory">*</span>
                    <input type="text" class="form-control" id="form-name">
                </div> <!-- end of form name -->

                <div class="form-group"> <!-- form description -->
                    <label for="form-description">Descrição do questionário</label> <span class="mandatory">*</span>
                    <textarea class="form-control" rows="3" id="form-description"></textarea>
                </div> <!-- end of form description -->

                <div class="form-group"> <!-- form style -->
                    <label>Estilo do questionário</label><span class="mandatory">*</span> <br/>
                    <label class="radio-inline"><input type="radio" id="radio-black" name="optradio" value="preto">Fundo
                        preto</label>
                    <label class="radio-inline"><input type="radio" id="radio-white" name="optradio" value="branco">Fundo
                        branco</label>
                </div> <!-- end of form style -->

                <label>Miniatura do questionário</label><br/> <!-- form thumbnail -->
                <div id="previous-thumbnail">
                    <p>Previamente carregada</p>
                </div>

                <p>Obs.: Ao carregar uma miniatura nova, irá apagar a previamente carregada.</p>
                <div class="input-group" id="form-thumbnail">
                    <label class="input-group-btn">
                        <span class="btn btn-default">
                            <span class="glyphicon glyphicon-folder-open"></span> Pesquisar
                            <input style="display: none;" type="file" accept="image/gif, image/jpeg, image/png, image/jpg" id="input-thumbnail" onchange="getFileNames(0)">
                        </span>
                        <button id="btn-load-thumbnail" class="btn btn-primary" type="button" onclick="saveThumbnail()"><span
                                class="glyphicon glyphicon-import"></span>Carregar
                        </button>
                    </label>
                    <input id="files-selected" type="text" class="form-control" readonly>
                </div> <!-- end of form thumbnail -->

                <br/>
                <div id="content-added-by-user" class="form-group"> <!-- user content -->
                    <!-- Here stays the content inserted by the user -->
                </div> <!-- end of user content -->
            </form> <!-- ./form-questionnaire -->
        </div> <!-- ./col-sm-6 -->

        <div class="col-sm-3"></div>

    </div>

    <div class="btn-fixed-down">
        <button class="btn btn-md btn-grey" id="add-break">
            <span class="glyphicon glyphicon-align-justify"></span> Criar Tarefa
        </button>
    </div> <!-- ./btn-fixed-down -->

</div>

<!-- Modal for Edits -->
<div id="modal-for-edits" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-body">
                <p align="center"><strong>Aguarde...</strong></p>
                <p align="center">O seu questionário está a ser processado.</p>
            </div>
        </div>

    </div>
</div> <!-- ./ modal-for-saves -->

<!-- Modal for Pre-visualization -->
<div id="modal-for-visualization" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-body">
                <p align="center"><strong>Aguarde...</strong></p>
                <p align="center">A pré-visualização está a ser gerada.</p>
            </div>
        </div>

    </div>
</div> <!-- ./ modal-for-visualization -->

</body>
</html>

<!-- JavaScript
    ================================================== -->
<script src="{% static 'js/jquery.min.js' %}"></script>
<script src="{% static 'js/toastr.min.js' %}"></script>
<script src="{% static 'js/bootstrap.min.js' %}"></script>
<script src="{% static 'js/new_form.js' %}"></script>
<script src="{% static 'js/clone_form.js' %}"></script>
<script src="{% static 'js/edit_form.js' %}"></script>
<script type="text/javascript" src="https://www.dropbox.com/static/api/2/dropins.js" id="dropboxjs"
        data-app-key="5lq56uzonzeai0d"></script>

<script>
    /**
     * For toggles
     */
    $(document).ready(function () {
        $('[data-toggle="tooltip"]').tooltip();
    });
</script>

<script>

    /**
     * Wait for window load.
     */
    $(window).load(function () {
        // Animate loader off screen
        $(".se-pre-con").fadeOut();
        $("#clone-container").show();
    });

    var csrfToken = "{{ csrf_token }}";
    var onSuccess = "{% url 'home' %}";
    var defaultThumbnail = "{% static 'images/forms_icon.png' %}";
    var urlToVisualization = "{% url 'preview-form' %}";

    var urlToPost = "{% url 'edit-form' formID %}";
    var formID = "{{formID}}";

    var src = ('{{formConfig|safe}}').replace(/[\n]/g, '\\n');

    var formThumbnail = "{{formThumbnail}}";
    var imgThumbnail;

    var formConfiguration = JSON.parse(src);

    document.getElementById("form-name").value = document.getElementById("form-name").defaultValue = formConfiguration.nome; // loads name
    document.getElementById("form-description").value = document.getElementById("form-name").defaultValue = formConfiguration.descricao; // loads description

    if (formThumbnail != "" && formThumbnail != "/static/images/forms_icon.png") {
        document.querySelector("#previous-thumbnail").innerHTML += '<img height="100" src="' + formThumbnail + '"><br/><br/>';
        imgThumbnail = formThumbnail;
    }
    else {
        document.querySelector("#previous-thumbnail").innerHTML += '<img height="100" src="' + defaultThumbnail + '"><br/><br/>';
    }

    // loads color
    if (formConfiguration.corFundo == "preto") {
        $("#radio-black").prop("checked", true);

    } else {
        $("#radio-white").prop("checked", true);
    }

    var sizeOfForm = 0;
    if (formConfiguration.hasOwnProperty("passos")) {
        sizeOfForm = formConfiguration.passos.length;
    }
</script>